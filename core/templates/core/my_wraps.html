{% extends 'core/base.html' %}
{% load static %}

{% block content %}

    <div class="wrap-grid">
        {% for image, id in combined %}
            <div class="wrap-item">
                <a href="{% url 'wrapped_page' wrap_id=id %}" class="wrap-link">
                    <div class="wrap-thumbnail">
                        <img src="{{ image }}" alt="Wrap {{ forloop.counter }}" style="width: 100%">
                        <div class="wrap-info">
                            <div>Wrap {{ forloop.counter }}</div>
                            <div class="wrap-actions">
                                <!-- Share button with data-url and data-title attributes for JavaScript -->
                                <button class="share-btn"
                                        data-url="{% url 'wrapped_page' wrap_id=id %}"
                                        data-title="Check out my Wrapped!">
                                    <i class="fas fa-share-alt"></i>
                                    <span>Share</span>
                                </button>
                                <button class="delete-btn">
                                    <i class="fas fa-trash"></i>
                                    <span>Delete</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        {% endfor %}

        <!-- Button to generate new wrap items -->
        <a href="{% url 'generate' %}" class="add-wrap">
            <div class="add-button">
                <svg width="24" height="24" viewBox="0 0 24 24">
                    <path d="M12 4v16m-8-8h16" stroke="currentColor" stroke-width="2"/>
                </svg>
            </div>
        </a>
    </div>

    <!-- Include JavaScript for direct sharing functionality -->
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const shareButtons = document.querySelectorAll('.share-btn');
    const linkDisplayArea = document.getElementById('link-display-area');

    // Function to get the current domain
    function getFullyQualifiedUrl(relativeUrl) {
        const domain = window.location.origin; // e.g., https://yourdomain.com
        return `${domain}${relativeUrl}`;
    }

    shareButtons.forEach(button => {
        button.addEventListener('click', function() {
            const relativeUrl = this.dataset.url; // Get the relative URL from data-url
            const fullUrl = getFullyQualifiedUrl(relativeUrl); // Make it fully qualified
            const title = this.dataset.title;

            // Open the social media sharing options directly
            openSocialMediaDialog(fullUrl, title);
        });
    });

    // Function to open social media share dialogs
    function openSocialMediaDialog(url, title) {
        const encodedUrl = encodeURIComponent(url);
        const encodedTitle = encodeURIComponent(title);

        // Options for sharing
        const options = [
            {
                name: "Instagram",
                url: `https://www.instagram.com/`, // Note: Instagram doesn't support direct URL sharing, requires manual post
            },
            {
                name: "Twitter",
                url: `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`
            },
            {
                name: "LinkedIn",
                url: `https://www.linkedin.com/shareArticle?mini=true&url=${encodedUrl}&title=${encodedTitle}`
            },
        ];

        // Show the prompt to the user
        let menu = "Choose where to share:\n\n";
        options.forEach((opt, index) => {
            menu += `${index + 1}. ${opt.name}\n`;
        });

        const choice = prompt(menu);
        const chosenOption = options[parseInt(choice) - 1];

        if (chosenOption && chosenOption.url) {
            // Open the chosen social media share URL in a new window
            window.open(chosenOption.url, "_blank", "width=600,height=400");

            // Display the URL if itâ€™s LinkedIn to allow manual sharing
            if (chosenOption.name === "LinkedIn" && linkDisplayArea) {
                linkDisplayArea.textContent = `Share this LinkedIn link: ${url}`;
                linkDisplayArea.style.display = 'block';
            }
        }
    }
});



    </script>
{% endblock %}
